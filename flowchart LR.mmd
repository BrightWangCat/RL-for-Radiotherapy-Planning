flowchart LR
    %% --- Training Phase (Offline) ---
    subgraph Training ["fab:fa-python Training Loop (Offline)"]
        direction TB
        %% Nodes
        D("fa:fa-database Dataset (OpenKBP)")@{ shape: cyl }
        E("fa:fa-server Planning Environment<br/>(dose calc + reward + termination)")
        P("fa:fa-brain Policy π_θ (Actor-Critic NN)")
        R("fa:fa-layer-group Rollouts Buffer<br/>(s,a,r,s',done, logπ, V)")@{ shape: doc }
        A("fa:fa-sync-alt PPO Update")@{ shape: hex }

        %% Connections (explicit RL loop semantics)
        D -- "Sample case" --> E
        E -- "Observation s_t" --> P
        P -- "Action a_t (Δfluence)" --> E
        E -- "Transition (s_t,a_t,r_t,s_{t+1},done)" --> R
        R -- "Minibatches / GAE returns" --> A
        A -- "Update θ" --> P
    end

   

    %% --- Styling (Matches your example) ---
    %% Style for Training (Purple Theme)
    style P fill:#AA00FF, stroke:#4A148C, color:#fff
    style A fill:#E040FB, stroke:#4A148C, color:#fff, stroke-dasharray: 5 5



    %% Style for Data/Env (Neutral)
    style D fill:#ECEFF1, stroke:#455A64

